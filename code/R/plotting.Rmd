```{r, message=FALSE, warning=FALSE}
library(ggplot2)
library(dplyr)
library(latex2exp)

source('config.R')
```

## t-SNE Electrode Embedding
This is just a t-SNE embedding of the mean condition traces for each electrode.
TODO: Look at embedding of the mean LFP at each instance of a condition (how much do conditions vary?)
```{r}
d <- read.csv(file.path(data_dir, 'tsne.csv'))
d %>% ggplot(aes(x,y,color=labels,label=electrode_num)) +
    geom_text() +
    theme_minimal() +
    ggsave(file.path(plot_save_dir, 'tsne_plot_r.png'))
```

## Reaction Times and LFP Slope
Checking to see if the slope of the mean LFP signal ranging from 200 ms prior to a shape stimulus to the saccade is correlated with the reaction time (the time between the shape and saccade).
```{r}
d <- read.csv(file.path(data_dir, 'slope_data.csv'))
colnames(d) <- c('slopes', 'rxn_times')
mod <- lm(rxn_times ~ slopes, d)
summary(mod)
ggplot(d, aes(slopes, rxn_times)) + 
  geom_point() +
  theme_minimal()
```

So, not much to be seen here...

```{r}
d <- read.csv(file.path(data_dir, 'rxns_and_slopes.csv'), header = F, col.names = c('electrode','slope','rxn'))
pdf(file = file.path(plot_save_dir, 'rxn_and_slopes.pdf'))
for (i in 1:max(d$electrode)) {
  tmp <- d %>% filter(electrode == i)
  mod <- lm(rxn~slope, data = tmp)
  r_squared <- summary(mod)$r.squared
  p_val <- summary(mod)$coefficients[2,4]
  p <- tmp %>%
    ggplot(aes(slope, rxn)) +
    geom_point() +
    stat_smooth(method = 'lm') +
    xlim(c(-3, 3)) + ylim(c(200, 700)) +
    xlab('Slope') + ylab('Reaction time (ms)') + 
    ggtitle(TeX(sprintf('Electrode %d, $R^2 = %.3f$, $p = %.5f$', i, r_squared, p_val))) +
    theme_minimal()
  print(p)
}
dev.off()
```